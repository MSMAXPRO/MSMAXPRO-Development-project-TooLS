<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Ghost Touch - AI Gesture Control</title>
    <!-- Import MediaPipe Hands & Drawing Utils -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
    
    <style>
        body { margin: 0; background: #0f172a; color: white; font-family: 'Segoe UI', sans-serif; overflow: hidden; }
        
        /* Layout */
        .container { display: flex; height: 100vh; }
        
        /* Webcam Panel (Left) */
        .cam-panel {
            width: 320px; background: #000; position: relative; border-right: 2px solid #334155;
            display: flex; justify-content: center; align-items: center; flex-direction: column;
        }
        
        video { display: none; } /* Hide raw video */
        
        canvas.output_canvas {
            width: 100%; height: auto; transform: scaleX(-1); /* Mirror effect */
            border-bottom: 2px solid #00ffcc;
        }

        .status { padding: 20px; color: #00ffcc; font-size: 0.9rem; text-align: center; }
        .instructions { padding: 20px; font-size: 0.8rem; color: #94a3b8; line-height: 1.6; }

        /* Content Panel (Right - Scrollable) */
        .content-panel {
            flex: 1; padding: 50px; overflow-y: auto; scroll-behavior: smooth; position: relative;
        }

        .article { max-width: 800px; margin: 0 auto; }
        h1 { font-size: 3rem; margin-bottom: 20px; color: #38bdf8; }
        p { font-size: 1.2rem; line-height: 1.8; color: #cbd5e1; margin-bottom: 20px; }
        
        .dummy-img { width: 100%; height: 300px; background: #1e293b; border-radius: 10px; margin: 20px 0; }
        
        .interactive-btn {
            padding: 15px 30px; background: #e11d48; border: none; color: white; font-size: 1.2rem; border-radius: 50px; cursor: pointer; transition: 0.3s;
        }
        .interactive-btn:hover, .interactive-btn.hovered {
            background: #fff; color: #e11d48; transform: scale(1.1); box-shadow: 0 0 20px #e11d48;
        }

        /* The Ghost Cursor */
        .ghost-cursor {
            position: fixed; width: 20px; height: 20px;
            background: rgba(0, 255, 204, 0.7);
            border: 2px solid #fff; border-radius: 50%;
            pointer-events: none; /* Let clicks pass through */
            z-index: 9999;
            transform: translate(-50%, -50%);
            transition: width 0.1s, height 0.1s, background 0.1s;
            box-shadow: 0 0 15px #00ffcc;
        }
        
        .ghost-cursor.clicking {
            background: #ff0055; width: 15px; height: 15px;
        }

        /* Scroll Zones */
        .scroll-zone {
            position: fixed; left: 320px; right: 0; height: 100px; 
            background: linear-gradient(to bottom, rgba(0, 255, 204, 0.1), transparent);
            pointer-events: none; display: flex; justify-content: center; align-items: center;
            color: #00ffcc; font-weight: bold; letter-spacing: 2px; opacity: 0; transition: 0.3s;
        }
        .scroll-top { top: 0; }
        .scroll-bottom { bottom: 0; background: linear-gradient(to top, rgba(0, 255, 204, 0.1), transparent); }
        
        .active-zone { opacity: 1; }
    </style>
</head>
<body>

    <!-- Virtual Cursor -->
    <div id="cursor" class="ghost-cursor"></div>

    <!-- Scroll Indicators -->
    <div id="zoneTop" class="scroll-zone scroll-top">SCROLL UP</div>
    <div id="zoneBottom" class="scroll-zone scroll-bottom">SCROLL DOWN</div>

    <div class="container">
        <!-- Sidebar for Camera -->
        <div class="cam-panel">
            <h3 style="color: white; margin: 10px;">GHOST TOUCH</h3>
            <canvas class="output_canvas" width="320" height="240"></canvas>
            <div class="status" id="status">Loading AI Model...</div>
            <div class="instructions">
                1. <strong>Move:</strong> Use Index Finger to move cursor.<br>
                2. <strong>Click:</strong> Pinch Index & Thumb.<br>
                3. <strong>Scroll:</strong> Move hand to Top or Bottom edge.
            </div>
        </div>

        <!-- Main Website Content -->
        <div class="content-panel" id="scrollContainer">
            <div class="article">
                <h1>Future Interface</h1>
                <p>Welcome to the touchless era. You are controlling this entire page without touching your mouse or screen. Just wave your hand in the air.</p>
                <div class="dummy-img"></div>
                <p>Computer vision algorithms are tracking 21 landmarks on your hand in real-time. By mapping your index finger's coordinates to the screen dimensions, we create a virtual mouse.</p>
                <button class="interactive-btn" onclick="alert('Ghost Click Successful!')">Try Clicking Me!</button>
                <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
                <div class="dummy-img"></div>
                <p>Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
                <p>Keep scrolling down using gestures...</p>
                <button class="interactive-btn" onclick="document.body.style.background = '#220033'">Change Theme</button>
                <div style="height: 500px;"></div>
                <p>You reached the bottom!</p>
            </div>
        </div>
    </div>

    <!-- Hidden Video for Input -->
    <video class="input_video"></video>

    <script>
        const videoElement = document.getElementsByClassName('input_video')[0];
        const canvasElement = document.getElementsByClassName('output_canvas')[0];
        const canvasCtx = canvasElement.getContext('2d');
        const cursor = document.getElementById('cursor');
        const scrollContainer = document.getElementById('scrollContainer');
        const statusText = document.getElementById('status');
        const zoneTop = document.getElementById('zoneTop');
        const zoneBottom = document.getElementById('zoneBottom');

        let isClicking = false;

        function onResults(results) {
            canvasCtx.save();
            canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);
            
            // Draw camera feed
            canvasCtx.drawImage(results.image, 0, 0, canvasElement.width, canvasElement.height);

            if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
                statusText.innerText = "HAND DETECTED";
                statusText.style.color = "#00ffcc";

                const landmarks = results.multiHandLandmarks[0];
                
                // Draw skeleton on canvas
                drawConnectors(canvasCtx, landmarks, HAND_CONNECTIONS, {color: '#00ffcc', lineWidth: 2});
                drawLandmarks(canvasCtx, landmarks, {color: '#ff0055', lineWidth: 1});

                // --- GESTURE LOGIC ---
                
                // 1. Get Coordinates of Index Tip (8) and Thumb Tip (4)
                // Landmarks are normalized [0.0, 1.0]. 
                // x is inverted because of mirror effect
                const indexTip = landmarks[8];
                const thumbTip = landmarks[4];
                
                // Map Index Tip to Screen Coordinates
                const x = (1 - indexTip.x) * window.innerWidth;
                const y = indexTip.y * window.innerHeight;

                // Move Ghost Cursor
                cursor.style.left = `${x}px`;
                cursor.style.top = `${y}px`;

                // 2. Click Detection (Pinch)
                // Calculate distance between Index and Thumb
                const distance = Math.hypot(indexTip.x - thumbTip.x, indexTip.y - thumbTip.y);
                
                if (distance < 0.05) { // Threshold for pinch
                    if (!isClicking) {
                        cursor.classList.add('clicking');
                        triggerClick(x, y);
                        isClicking = true;
                    }
                } else {
                    cursor.classList.remove('clicking');
                    isClicking = false;
                }

                // 3. Hover Effects
                checkHover(x, y);

                // 4. Scroll Logic (Based on Y position)
                if (y < window.innerHeight * 0.15) {
                    // Top Zone
                    scrollContainer.scrollBy(0, -15);
                    zoneTop.classList.add('active-zone');
                    zoneBottom.classList.remove('active-zone');
                } else if (y > window.innerHeight * 0.85) {
                    // Bottom Zone
                    scrollContainer.scrollBy(0, 15);
                    zoneBottom.classList.add('active-zone');
                    zoneTop.classList.remove('active-zone');
                } else {
                    zoneTop.classList.remove('active-zone');
                    zoneBottom.classList.remove('active-zone');
                }

            } else {
                statusText.innerText = "WAVE HAND TO START";
                statusText.style.color = "white";
            }
            canvasCtx.restore();
        }

        function triggerClick(x, y) {
            // Find element at position and click it
            const el = document.elementFromPoint(x, y);
            if (el) el.click();
        }

        function checkHover(x, y) {
            // Add hover effect manually since real mouse isn't moving
            const el = document.elementFromPoint(x, y);
            document.querySelectorAll('.interactive-btn').forEach(b => b.classList.remove('hovered'));
            
            if (el && el.classList.contains('interactive-btn')) {
                el.classList.add('hovered');
            }
        }

        // Initialize MediaPipe Hands
        const hands = new Hands({locateFile: (file) => {
            return `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`;
        }});

        hands.setOptions({
            maxNumHands: 1,
            modelComplexity: 1,
            minDetectionConfidence: 0.7,
            minTrackingConfidence: 0.7
        });

        hands.onResults(onResults);

        // Start Camera
        const camera = new Camera(videoElement, {
            onFrame: async () => {
                await hands.send({image: videoElement});
            },
            width: 320,
            height: 240
        });
        camera.start();

    </script>
</body>
</html>